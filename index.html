import React, { useState, useEffect } from 'react';
import { TrendingUp, PiggyBank, Landmark, CalendarDays } from 'lucide-react';

// --- Helper Functions ---
/**
 * Determines the withholding tax rate based on the payout interval.
 * This is an interpretation for flexible/recurring payout accounts based on Turkish tax laws for TRY deposits as of recent regulations.
 * @param {number} intervalDays - The interest payout interval in days.
 * @returns {number} The tax rate as a percentage (e.g., 17.5 for 17.5%).
 */
const getTaxRate = (intervalDays) => {
  if (intervalDays <= 182) { // Up to 6 months
    return 17.5;
  } else if (intervalDays <= 365) { // Up to 1 year
    return 15;
  } else { // Over 1 year
    return 10;
  }
};

/**
 * Formats a number into a currency string (TRY).
 * @param {number} amount - The number to format.
 * @returns {string} The formatted currency string.
 */
const formatCurrency = (amount) => {
  return new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(amount);
};


// --- UI Components ---
const InputField = ({ icon, label, value, onChange, placeholder, type = "number" }) => (
  <div className="w-full">
    <label className="text-sm font-medium text-gray-400 flex items-center mb-2">
      {icon}
      <span className="ml-2">{label}</span>
    </label>
    <input
      type={type}
      value={value}
      onChange={onChange}
      placeholder={placeholder}
      className="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
    />
  </div>
);

const StatCard = ({ icon, title, value, color }) => (
  <div className="bg-gray-800 p-4 rounded-lg flex items-center">
    <div className={`p-3 rounded-full mr-4 ${color}`}>
      {icon}
    </div>
    <div>
      <p className="text-sm text-gray-400">{title}</p>
      <p className="text-xl font-bold text-white">{value}</p>
    </div>
  </div>
);

const App = () => {
  // --- State Management ---
  const [initialCapital, setInitialCapital] = useState('100000');
  const [yearlyRate, setYearlyRate] = useState('45');
  const [payoutInterval, setPayoutInterval] = useState('32');
  const [results, setResults] = useState([]);
  const [summary, setSummary] = useState({ totalProfit: 0, totalTax: 0 });

  // --- Calculation Logic ---
  const calculateProfit = () => {
    const capital = parseFloat(initialCapital);
    const rate = parseFloat(yearlyRate);
    const interval = parseInt(payoutInterval, 10);

    // Input validation
    if (isNaN(capital) || isNaN(rate) || isNaN(interval) || capital <= 0 || rate <= 0 || interval <= 0) {
      setResults([]);
      setSummary({ totalProfit: 0, totalTax: 0 });
      return;
    }

    let currentCapital = capital;
    const newResults = [];
    let cumulativeProfit = 0;
    let cumulativeTax = 0;
    const taxRate = getTaxRate(interval) / 100;

    for (let i = 1; i <= 100; i++) {
      // Calculate interest for the current period
      const interestEarned = currentCapital * (rate / 100) * (interval / 365);
      
      // Calculate tax on the earned interest
      const taxPaid = interestEarned * taxRate;
      
      // Calculate net profit
      const netProfit = interestEarned - taxPaid;
      
      // Update cumulative totals
      cumulativeProfit += netProfit;
      cumulativeTax += taxPaid;
      
      // Update the capital for the next period (compounding)
      currentCapital += netProfit;

      newResults.push({
        period: i,
        day: i * interval,
        capital: currentCapital,
        profit: netProfit,
        tax: taxPaid,
      });
    }

    setResults(newResults);
    setSummary({ totalProfit: cumulativeProfit, totalTax: cumulativeTax });
  };

  // --- Effects ---
  // Run calculation on initial load and whenever inputs change
  useEffect(() => {
    calculateProfit();
  }, [initialCapital, yearlyRate, payoutInterval]);

  // --- Render ---
  return (
    <div className="bg-gray-900 min-h-screen text-white font-sans p-4 sm:p-6 lg:p-8">
      <div className="max-w-7xl mx-auto">
        <header className="text-center mb-8">
          <h1 className="text-4xl font-bold text-blue-400">Interest Profit Calculator</h1>
          <p className="text-gray-400 mt-2">Model your investment growth with compound interest and Turkish withholding tax.</p>
        </header>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* --- Left Column: Controls & Summary --- */}
          <div className="lg:col-span-1 space-y-6">
            <div className="bg-gray-800 p-6 rounded-xl shadow-lg">
              <h2 className="text-2xl font-semibold mb-4">Parameters</h2>
              <div className="space-y-4">
                <InputField
                  icon={<PiggyBank size={20} className="text-gray-400" />}
                  label="Initial Capital (TRY)"
                  value={initialCapital}
                  onChange={(e) => setInitialCapital(e.target.value)}
                  placeholder="e.g., 100000"
                />
                <InputField
                  icon={<TrendingUp size={20} className="text-gray-400" />}
                  label="Yearly Interest Rate (%)"
                  value={yearlyRate}
                  onChange={(e) => setYearlyRate(e.target.value)}
                  placeholder="e.g., 45"
                />
                <InputField
                  icon={<CalendarDays size={20} className="text-gray-400" />}
                  label="Payout Interval (Days)"
                  value={payoutInterval}
                  onChange={(e) => setPayoutInterval(e.target.value)}
                  placeholder="e.g., 32"
                />
              </div>
            </div>

            <div className="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 className="text-2xl font-semibold mb-4">Summary (100 Payouts)</h2>
                <div className="space-y-4">
                    <StatCard 
                        icon={<Landmark size={24} />} 
                        title="Net Profit" 
                        value={formatCurrency(summary.totalProfit)}
                        color="bg-green-500/20"
                    />
                    <StatCard 
                        icon={<Landmark size={24} />} 
                        title="Yoinked by RTE:" 
                        value={formatCurrency(summary.totalTax)}
                        color="bg-red-500/20"
                    />
                </div>
            </div>
             <div className="bg-gray-800 p-4 rounded-xl text-sm text-gray-400">
                <h3 className="font-semibold text-white mb-2">Tax Calculation Note:</h3>
                <p>The withholding tax (stopaj) is estimated based on the payout interval:</p>
                <ul className="list-disc list-inside mt-2 space-y-1">
                    <li><span className="font-bold">17.5%</span> for intervals up to 6 months (182 days).</li>
                    <li><span className="font-bold">15%</span> for intervals between 6 months and 1 year.</li>
                    <li><span className="font-bold">10%</span> for intervals over 1 year.</li>
                </ul>
            </div>
          </div>

          {/* --- Right Column: Results Log --- */}
          <div className="lg:col-span-2 bg-gray-800 p-1 rounded-xl shadow-lg">
            <div className="h-[75vh] overflow-y-auto">
              <table className="w-full text-left">
                <thead className="sticky top-0 bg-gray-800 shadow-sm">
                  <tr>
                    <th className="p-4 text-sm font-semibold text-gray-300">Day</th>
                    <th className="p-4 text-sm font-semibold text-gray-300 text-right">Total Capital</th>
                    <th className="p-4 text-sm font-semibold text-gray-300 text-right">Period Profit</th>
                    <th className="p-4 text-sm font-semibold text-gray-300 text-right">Period Tax</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-700">
                  {results.length > 0 ? (
                    results.map((entry) => (
                      <tr key={entry.period} className="hover:bg-gray-700/50 transition-colors">
                        <td className="p-4 font-medium">{entry.day}</td>
                        <td className="p-4 text-right font-semibold text-blue-300">{formatCurrency(entry.capital)}</td>
                        <td className="p-4 text-right text-green-400">{formatCurrency(entry.profit)}</td>
                        <td className="p-4 text-right text-red-400">{formatCurrency(entry.tax)}</td>
                      </tr>
                    ))
                  ) : (
                    <tr>
                      <td colSpan="4" className="text-center p-16 text-gray-500">
                        Please enter valid numbers in all fields to see the calculation.
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default App;
